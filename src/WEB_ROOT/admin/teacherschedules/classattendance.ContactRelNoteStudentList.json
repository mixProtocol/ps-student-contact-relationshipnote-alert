[
  ~[if#sec.security.pagenone=/admin/teacherschedules/classattendance.html]
  [else#sec]
  ~[tlist_sql;
  SELECT
    JSON_OBJECT (
      'sDcid' VALUE TO_CHAR(s.Dcid),
      'ccId' VALUE TO_CHAR(cc.ID)
    )

  FROM Students s

  JOIN CC cc
    ON s.Id = cc.StudentId
   AND s.SchoolId = cc.SchoolId
   AND FLOOR(ABS(cc.TermID)/100) = ~(curyearid)
   AND ( ABS(cc.SectionID) = (~(gpv.sectionid;num) - 0)
         OR ( 'multimeeting' LIKE LOWER('~(gpv.pagetype;sqlText)')
              AND cc.ID in (~(gpv.CCIDs;sqlText)) ) )

  
  JOIN StudentContactAssoc sca ON s.Dcid = sca.StudentDcid

  JOIN StudentContactDetail scd
    ON sca.StudentContactAssocId = scd.StudentContactAssocId
   AND scd.RelationshipNote IS NOT NULL
   AND LENGTH(TRIM(scd.RelationshipNote)) > 0

  GROUP BY s.Dcid, cc.Id
  ]
  ~(jsonObj),
  [/tlist_sql]
  [/if#sec]
{}]
